---
title: "Lab 7"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(gradethis)
library(learnr)
library(readr)

tutorial_options(exercise.checker = gradethis::grade_learnr)

library(ggplot2)

## Voting

phat_voting <- 366/500
SE_voting <- sqrt(phat_voting*(1-phat_voting)/500)
zstar_90 <- qnorm(0.95, mean = 0, sd = 1)
MoE_voting <- zstar_90*SE_voting
```

## Goals

Your goal is practice calculating the expected value and variance for a random variable, evaluating more probabilities, and using the Central Limit Theorem. 

## Part 1: Loading Packages

No new libraries today!

## Part 2: Reading in Data

No data to read in today!

## Part 3: More CLT Practice

### Baggage

An airline charges the following baggage fees: $\$25$ for the first bag and $\$35$ for the second. Suppose 54\% of passengers have no checked luggage, 34\% have one piece of checked luggage, and 12\% have two pieces. The distribution of money earned per passenger is summarized in the table below. 

$L$ | $0$ | $\$25$ | $\$60$ 
----|---|---|---
$P(L)$ | 0.54 | 0.34 | 0.12

Verify that this is a valid probability distribution. 

```{r baggage1, exercise = TRUE}

```

```{r baggage1-solution, message = FALSE, warning = FALSE}
0.54 + 0.34 + 0.12
```

```{r baggage1-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the expected value of $L$? Save it as `exp_baggage`.

```{r baggage2, exercise = TRUE}

```

```{r baggage2-solution, message = FALSE, warning = FALSE}
exp_baggage <- sum(c(0, 25, 60)*c(0.54, 0.34, 0.12))
exp_baggage
```

```{r baggage2-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the corresponding standard deviation? Save it as `sd_baggage`.

```{r prepare-baggage1, message = FALSE}
exp_baggage <- sum(c(0, 25, 60)*c(0.54, 0.34, 0.12))
```

```{r baggage3, exercise = TRUE, exercise.setup = "prepare-baggage1"}

```

```{r baggage3-solution, message = FALSE, warning = FALSE}
sd_baggage <- sqrt(sum((c(0, 25, 60) - exp_baggage)^2*c(0.54, 0.34, 0.12)))
sd_baggage
```

```{r baggage3-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the probability that a customer pays for at least one piece of baggage?

```{r baggage4, exercise = TRUE}

```

```{r baggage4-solution, message = FALSE, warning = FALSE}
0.34 + 0.12
```

```{r baggage4-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, 0.34 + 0.12))
})
```

Now assume that a plane can hold 160 passengers, and assume these passengers are a random sample. What is the standard error of the sampling distribution of the mean amount of baggage for these passengers? Save it as `se_baggage`.

```{r prepare-baggage2, message = FALSE}
exp_baggage <- sum(c(0, 25, 60)*c(0.54, 0.34, 0.12))
sd_baggage <- sqrt(sum((c(0, 25, 60) - exp_baggage)^2*c(0.54, 0.34, 0.12)))
```

```{r baggage5, exercise = TRUE, exercise.setup = "prepare-baggage2"}

```

```{r baggage5-solution, message = FALSE, warning = FALSE}
se_baggage <- sd_baggage/sqrt(160)
se_baggage
```

```{r baggage5-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the probability that the mean amount of money earned for 160 passengers is greater than $\$20$?

```{r prepare-baggage3, message = FALSE}
exp_baggage <- sum(c(0, 25, 60)*c(0.54, 0.34, 0.12))
sd_baggage <- sqrt(sum((c(0, 25, 60) - exp_baggage)^2*c(0.54, 0.34, 0.12)))
se_baggage <- sd_baggage/sqrt(160)
```

```{r baggage6, exercise = TRUE, exercise.setup = "prepare-baggage3"}

```

```{r baggage6-solution, message = FALSE, warning = FALSE}
1 - pnorm(20, mean = exp_baggage, sd = se_baggage)
```

```{r baggage6-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, 1 - pnorm(20, mean = exp_baggage, sd = se_baggage)))
})
```

### Coffee Shops

Sally gets a cup of coffee and a muffin every day for breakfast from one of many coffee shops in her neighborhood. She picks a coffee shop at random and independently of previous days. The average price of a cup of coffee is $\$1.40$ with a standard deviation of $\$0.30$, and the average price of a muffin is $\$2.50$ with a standard deviation of $\$0.15$. The price of the coffee and the price of the muffin are independent of each other. 

How much money should Sally expect to spend on her coffee and muffin every day? Save it as `exp_coffee`.

```{r coffee1, exercise = TRUE}

```

```{r coffee1-solution, message = FALSE, warning = FALSE}
exp_coffee <- 1.4 + 2.50
exp_coffee
```

```{r coffee1-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the standard deviation of the money Sally spends on her coffee and muffin every day? Save it as `sd_coffee`. 

```{r prepare-coffee1, message = FALSE}
exp_coffee <- 1.4 + 2.50
```

```{r coffee2, exercise = TRUE, exercise.setup = "prepare-coffee1"}

```

```{r coffee2-solution, message = FALSE, warning = FALSE}
sd_coffee <- sqrt(0.30^2 + 0.15^2)
sd_coffee
```

```{r coffee2-check, message = FALSE, warning = FALSE}
grade_code()
```

Can we use the Central Limit Theorem to analyze the average daily amount Sally spends in one week (7 days)? Why or why not?

Instead of analyzing the amount of money Sally spends in one week, calculate the sampling error for the average daily amount from a month's worth of observations (30 days). Save it as `se_coffee`. 

```{r prepare-coffee2, message = FALSE}
exp_coffee <- 1.4 + 2.50
sd_coffee <- sqrt(0.30^2 + 0.15^2)
```

```{r coffee3, exercise = TRUE, exercise.setup = "prepare-coffee2"}

```

```{r coffee3-solution, message = FALSE, warning = FALSE}
se_coffee <- sd_coffee/sqrt(30)
se_coffee
```

```{r coffee3-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the probability that Sally's monthly average is less than $\$3.95$?

```{r prepare-coffee3, message = FALSE}
exp_coffee <- 1.4 + 2.50
sd_coffee <- sqrt(0.30^2 + 0.15^2)
se_coffee <- sd_coffee/sqrt(30)
```

```{r coffee4, exercise = TRUE, exercise.setup = "prepare-coffee3"}

```

```{r coffee4-solution, message = FALSE, warning = FALSE}
pnorm(3.95, mean = exp_coffee, sd = se_coffee)
```

```{r coffee4-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, pnorm(3.95, mean = exp_coffee, sd = se_coffee)))
})
```

What is the probability that Sally's monthly average is greater than $\$3.80$?

```{r coffee5, exercise = TRUE, exercise.setup = "prepare-coffee3"}

```

```{r coffee5-solution, message = FALSE, warning = FALSE}
1 - pnorm(3.80, mean = exp_coffee, sd = se_coffee)
```

```{r coffee5-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, 1 - pnorm(3.80, mean = exp_coffee, sd = se_coffee)))
})
```

What is the probability that Sally's monthly average is between $\$3.85$ and $\$4.00$?

```{r coffee6, exercise = TRUE, exercise.setup = "prepare-coffee3"}

```

```{r coffee6-solution, message = FALSE, warning = FALSE}
pnorm(4.00, mean = exp_coffee, sd = se_coffee) - pnorm(3.85, mean = exp_coffee, sd = se_coffee)
```

```{r coffee6-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, pnorm(4.00, mean = exp_coffee, sd = se_coffee) - pnorm(3.85, mean = exp_coffee, sd = se_coffee)))
})
```

## Part 4: Percentiles and $z^*$

### Finding $z^*$

In this class, we will focus on two-sided confidence intervals. Remember that a two-sided, 95\% confidence interval extends 1.96 standard errors on either side--we choose 1.96 because 95\% of the area under a normal curve is between -1.96 and 1.96. 

If 95\% of the area is between -1.96 and 1.96, then 5\% of the area is on the outside. Remember also that a normal curve is perfectly symmetric, so we can evenly divide the 5\% of area on the outside into two pieces... 2.5\% below -1.96, and 2.5\% above 1.96. 

```{r echo = F, fig.height = 4}
ggplot(NULL, aes(c(-3,3))) +
 geom_area(stat = "function", fun = dnorm, fill = "lightgray", xlim = c(-3, 3)) +
 geom_area(stat = "function", fun = dnorm, fill = "dodgerblue3", xlim = c(qnorm(0.025), qnorm(0.975))) +
 annotate("text", x = 0, y = 0.024, label = "95%", color = "gray20", size = 9) +
 annotate("text", x = -2.16, y = 0.0165, label = "2.5%", color = "gray20", size = 4) +
 annotate("text", x = 2.16, y = 0.0165, label = "2.5%", color = "gray20", size = 4) +
 scale_x_continuous(name = "", breaks = c()) +
 scale_y_continuous(name = "", limits = c(0, 0.42)) + 
 theme(legend.position = "none", axis.text.y=element_blank(), text = element_text(size=20), axis.text.x = element_text(hjust=1))
```

Then, the formula for the percentile required for a $(100-\alpha)\%$ confidence interval is $1-\frac{\alpha}{2}$. For example, a $95\%$ confidence interval uses $\alpha = 0.05$, and the percentile required is 0.975. 

```{r percentile1, echo=FALSE}
question("What percentile should be used for a 70% confidence interval?",
  answer("0.85", correct = TRUE),
  answer("0.7"),
  answer("0.3"),
  allow_retry = T,
  random_answer_order = TRUE
)
```

```{r percentile2, echo=FALSE}
question("What percentile should be used for a 46% confidence interval?",
  answer("0.73", correct = TRUE),
  answer("0.54"),
  answer("0.46"),
  allow_retry = T,
  random_answer_order = TRUE
)
```

```{r percentile3, echo=FALSE}
question("What percentile should be used for a 82% confidence interval?",
  answer("0.91", correct = TRUE),
  answer("0.82"),
  answer("0.15"),
  allow_retry = T,
  random_answer_order = TRUE
)
```

Find the quantile used for a $55\%$ confidence interval. 

```{r percentile4, exercise = TRUE}

```

```{r percentile4-solution, message = FALSE, warning = FALSE}
qnorm(1-0.45/2, mean = 0, sd = 1)
```

```{r percentile4-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, qnorm(1-0.45/2, mean = 0, sd = 1)))
})
```

Find the quantile used for a $38\%$ confidence interval. 

```{r percentile5, exercise = TRUE}

```

```{r percentile5-solution, message = FALSE, warning = FALSE}
qnorm(1-0.62/2, mean = 0, sd = 1)
```

```{r percentile5-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, qnorm(1-0.62/2, mean = 0, sd = 1)))
})
```

Find the quantile used for a $94\%$ confidence interval. 

```{r percentile6, exercise = TRUE}

```

```{r percentile6-solution, message = FALSE, warning = FALSE}
qnorm(1-0.06/2, mean = 0, sd = 1)
```

```{r percentile6-check, message = FALSE, warning = FALSE}
grade_result({
  pass_if(~ all.equal(.result, qnorm(1-0.06/2, mean = 0, sd = 1)))
})
```

## Part 5: Confidence Intervals

### Emergencies at UMass Amherst

In 2019, the Amherst Fire Department responded to 5,741 emergencies, 1,030 of which were at the University of Massachusetts at Amherst (we will consider the year's worth of data to be a random sample of observations). What is the sample proportion of emergencies occurring at UMass Amherst? Save it as `phat_emergency`.

```{r emergency1, exercise = TRUE}

```

```{r emergency1-solution, message = FALSE, warning = FALSE}
phat_emergency <- 1030/5741
phat_emergency
```

```{r emergency1-check, message = FALSE, warning = FALSE}
grade_code()
```

Check the conditions on the sample proportion, $\hat{p}$ for a confidence interval.

```{r prepare-emergency1, message = FALSE}
phat_emergency <- 1030/5741
```

```{r emergency2, exercise = TRUE, exercise.setup = "prepare-emergency1"}

```

```{r emergency2-solution, message = FALSE, warning = FALSE}
phat_emergency*5741
(1-phat_emergency)*5741
```

```{r emergency2-check, message = FALSE, warning = FALSE}
grade_code()
```

```{r emergency3, echo=FALSE, eval = F}
question("Does this data meet the conditions?",
  answer("Yes", correct = TRUE),
  answer("No"),
  allow_retry = T,
)
```

What is the standard error for the sampling distribution of $\hat{p}$? Save it as `SE_emergency`. 

```{r emergency4, exercise = TRUE, exercise.setup = "prepare-emergency1"}

```

```{r emergency4-solution, message = FALSE, warning = FALSE}
SE_emergency <- sqrt(phat_emergency*(1-phat_emergency)/5741)
SE_emergency
```

```{r emergency4-check, message = FALSE, warning = FALSE}
grade_code()
```

Find the $z^*$ for a 99\% confidence interval. Save it as `zstar_99`. 

```{r emergency5, exercise = TRUE}

```

```{r emergency5-solution, message = FALSE, warning = FALSE}
zstar_99 <- qnorm(0.995, mean = 0, sd = 1)
```

```{r emergency5-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the margin of error for this interval? Save it as `MoE_emergency`.

```{r prepare-emergency2, message = FALSE}
phat_emergency <- 1030/5741
SE_emergency <- sqrt(phat_emergency*(1-phat_emergency)/5741)
zstar_99 <- qnorm(0.995, mean = 0, sd = 1)
```

```{r emergency6, exercise = TRUE, exercise.setup = "prepare-emergency2"}

```

```{r emergency6-solution, message = FALSE, warning = FALSE}
MoE_emergency <- zstar_99*SE_emergency
MoE_emergency
```

```{r emergency6-check, message = FALSE, warning = FALSE}
grade_code()
```

Find the lower and upper bounds of the confidence interval. 

```{r prepare-emergency3, message = FALSE}
phat_emergency <- 1030/5741
SE_emergency <- sqrt(phat_emergency*(1-phat_emergency)/5741)
zstar_99 <- qnorm(0.995, mean = 0, sd = 1)
MoE_emergency <- zstar_99*SE_emergency
```

```{r emergency7, exercise = TRUE, exercise.setup = "prepare-emergency3"}

```

```{r emergency7-solution, message = FALSE, warning = FALSE}
phat_emergency - MoE_emergency
phat_emergency + MoE_emergency
```

```{r emergency7-check, message = FALSE, warning = FALSE}
grade_code()
```

```{r emergency8, echo=FALSE, eval = F}
question("What is the correct intepretation of this interval?",
  answer("We are 99% confident that the true proportion of emergencies at UMass Amherst is between 0.166 and 0.192.", correct = TRUE),
  answer("We are 99% confident that the sample proportion of emergencies at UMass Amherst is between 0.166 and 0.192."),
  answer("The chance that an emergency was at UMass Amherst is between 0.166 and 0.192."),
  answer("There is a 99% chance that the proportion of emergencies at UMass Amherst is between 0.166 and 0.192."), 
  allow_retry = T,
  random_answer_order = TRUE
)
```

Confirm your results using `prop.test()` (it won't be identical, but it is good to check). Make sure to extract only the confidence interval!

```{r emergency9, exercise = TRUE}

```

```{r emergency9-solution, message = FALSE, warning = FALSE}
prop.test(x = 1030, n = 5741, conf.level = 0.99)
```

```{r emergency9-check, message = FALSE, warning = FALSE}
grade_code()
```

In 2019, UMass Amherst students made up 40\% of the Amherst population. Do you and your labmates think that 40\% is a reasonable value for the true proportion of emergencies occurring at UMass Amherst?

This problem was inspired by an article on the [union representing Amherst firefighters ](https://www.masslive.com/news/2020/02/drunk-umass-kids-are-not-the-problem-amherst-firefighters-renew-appeal-for-more-staff.html). 

### Voting Patterns at MHC

A random sample of 500 MHC students showed that 366 voted on Election Day for the 2016 Presidential Election. What is the sample proportion of MHC students who voted on Election Day 2016? Save it as `phat_voting`.

```{r voting1, exercise = TRUE}

```

```{r voting1-solution, message = FALSE, warning = FALSE}
phat_voting <- 366/500
phat_voting
```

```{r voting1-check, message = FALSE, warning = FALSE}
grade_code()
```

Check the conditions on the sample proportion, $\hat{p}$ for a confidence interval.

```{r prepare-voting1, message = FALSE}
phat_voting <- 366/500
```

```{r voting2, exercise = TRUE, exercise.setup = "prepare-voting1"}

```

```{r voting2-solution, message = FALSE, warning = FALSE}
phat_voting*500
(1-phat_voting)*500
```

```{r voting2-check, message = FALSE, warning = FALSE}
grade_code()
```

```{r voting3, echo=FALSE, eval = F}
question("Does this data meet the conditions?",
  answer("Yes", correct = TRUE),
  answer("No"),
  allow_retry = T,
)
```

What is the standard error for the sampling distribution of $\hat{p}$? Save it as `SE_voting`. 

```{r voting4, exercise = TRUE, exercise.setup = "prepare-voting1"}

```

```{r voting4-solution, message = FALSE, warning = FALSE}
SE_voting <- sqrt(phat_voting*(1-phat_voting)/500)
SE_voting
```

```{r voting4-check, message = FALSE, warning = FALSE}
grade_code()
```

Find the $z^*$ for a 90\% confidence interval. Save it as `zstar_90`. 

```{r voting5, exercise = TRUE}

```

```{r voting5-solution, message = FALSE, warning = FALSE}
zstar_90 <- qnorm(0.95, mean = 0, sd = 1)
```

```{r voting5-check, message = FALSE, warning = FALSE}
grade_code()
```

What is the margin of error for this interval? Save it as `MoE_voting`. 

```{r prepare-voting2, message = FALSE}
phat_voting <- 366/500
SE_voting <- sqrt(phat_voting*(1-phat_voting)/500)
zstar_90 <- qnorm(0.95, mean = 0, sd = 1)
```

```{r voting6, exercise = TRUE, exercise.setup = "prepare-voting2"}

```

```{r voting6-solution, message = FALSE, warning = FALSE}
MoE_voting <- zstar_90*SE_voting
MoE_voting
```

```{r voting6-check, message = FALSE, warning = FALSE}
grade_code()
```

Find the lower and upper bounds of the confidence interval.

```{r prepare-voting3, message = FALSE}
phat_voting <- 366/500
SE_voting <- sqrt(phat_voting*(1-phat_voting)/500)
zstar_90 <- qnorm(0.95, mean = 0, sd = 1)
MoE_voting <- zstar_90*SE_voting
```

```{r voting7, exercise = TRUE, exercise.setup = "prepare-voting3"}

```

```{r voting7-solution, message = FALSE, warning = FALSE}
phat_voting - MoE_voting
phat_voting + MoE_voting
```

```{r voting7-check, message = FALSE, warning = FALSE}
grade_code()
```

```{r voting8, echo=FALSE, eval = F}
question("What is the correct intepretation of this interval?",
  answer("We are 90% confident that the true proportion of MHC students who voted on Election Day 2016 is between 0.699 and 0.765.", correct = TRUE),
  answer("We are 90% confident that the sample proportion of MHC students who voted on Election Day 2016 is between 0.699 and 0.765."),
  answer("The chance that an MHC student voted on Election Day 2016 is between 0.699 and 0.765."),
  answer("There is a 90% chance that the true proportion of MHC students who voted on Election Day 2016 is available is between 0.699 and 0.765."), 
  allow_retry = T,
  random_answer_order = TRUE
)
```

Confirm your results using `prop.test()`. Make sure to extract only the confidence interval!

```{r voting9, exercise = TRUE}

```

```{r voting9-solution, message = FALSE, warning = FALSE}
prop.test(x = 366, n = 500, conf.level = 0.90)
```

```{r voting9-check, message = FALSE, warning = FALSE}
grade_code()
```

According to the same survey, the national average of students who voted on Election Day 2016 for all institutions in the US is 50\%. Do you and your labmates think that 50\% is a reasonable value for the true proportion of MHC students who voted on Election Day 2016?

This problem was inspired by an article on [MHC Votes](https://www.mtholyoke.edu/media/2020-sep/student-led-coalition-focuses-voting). 